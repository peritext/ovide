!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="https://peritext.github.io/ovide/build/",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=t.findProspectionMatches=({contents:e,sectionId:t,contentId:n,searchTerm:o,contextualizations:r,resources:s})=>{if(!o.length)return[];const c=new RegExp(o,"gi");let i=0;return e.blocks.filter(e=>"atomic"!==e.type).reduce((u,a)=>{const l=[];let d=null;const f=a.text;do{if(d=c.exec(f)){const c=d.index,u=d.index+o.length;let f=!0;a.entityRanges&&a.entityRanges.length&&a.entityRanges.find(t=>{const{key:n}=t,i=e.entityMap[n];if(i&&"INLINE_ASSET"===i.type&&(t.offset===c&&t.length===o.length||c>=t.offset&&c<=t.offset+t.length||u>=t.offset&&u<=t.offset+t.length)){const e=i.data.asset.id,t=r[e];if(t&&s[t.sourceId])return f=!1,!0}}),f&&(i++,l.push({sectionId:t,contentId:n,blockKey:a.key,offset:c,id:i,endIndex:u,length:o.length}))}}while(d);return[...u,...l]},[])};self.onmessage=({data:e})=>{const{type:t,payload:n}=e;if(t&&n)switch(t){case"BUILD_PROSPECTIONS":const e=(({production:e,searchTerm:t})=>{const{contextualizations:n,resources:r}=e;return Object.keys(e.resources).filter(t=>e.resources[t].data.contents&&e.resources[t].data.contents.contents&&e.resources[t].data.contents.contents.blocks).reduce((s,c)=>{const i=e.resources[c];return[...s,...o({contents:i.data.contents.contents,sectionId:c,contentId:"main",searchTerm:t,contextualizations:n,resources:r}),...i.data.contents.notesOrder.reduce((e,s)=>[...e,...o({contents:i.data.contents.notes[s].contents,sectionId:c,noteId:s,searchTerm:t,contextualizations:n,resources:r})],[])]},[])})(n);self.postMessage({type:t,response:{prospections:e}})}}}]);